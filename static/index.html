<!DOCTYPE html>
<html>
<head>
    <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@100;300;400;500&family=Source+Code+Pro&display=swap"
          rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/@mdi/font@4.x/css/materialdesignicons.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui">
    <style>
        *:not(.mdi) {
            font-family: 'Raleway', sans-serif !important;
        }

        #app .code * {
            font-family: 'Source Code Pro', cursive !important;
        }
    </style>
</head>
<body>
<div id="app">
    <v-app>
        <v-app-bar app fixed color="#6A76AB" dark shrink-on-scroll prominent src="https://picsum.photos/1920/1080?random">
            <template v-slot:img="{ props }">
                <v-img v-bind="props" gradient="to top right, rgba(100,115,201,.7), rgba(25,32,72,.7)"/>
            </template>
            <v-app-bar-nav-icon></v-app-bar-nav-icon>
            <v-toolbar-title>Aladdin - <span class="caption text--uppercase" style="font-family: 'Raleway', sans-serif">Code Gen</span>
            </v-toolbar-title>
            <v-spacer></v-spacer>

            <v-btn icon><v-icon>mdi-heart</v-icon></v-btn>
            <v-btn icon><v-icon>mdi-dots-vertical</v-icon></v-btn>
        </v-app-bar>
        <v-main>
            <v-container>
                <v-layout row>
                    <v-col cols="12" md="6">
                        <v-form>
                            <v-container>
                                <v-layout row>
                                    <v-col cols="6">
                                        <v-autocomplete label="Action" autocomplete v-model="action" :loading="loading"
                                                        :items="['spring.endpoint', 'action1']"
                                                        @change="loadForm"></v-autocomplete>
                                    </v-col>
                                    <v-col cols="12">
                                        <v-divider/>
                                    </v-col>
                                    <v-col cols="12">
                                        <v-subtitle>OPTIONS</v-subtitle>
                                    </v-col>
                                    <v-col cols="12">
                                        <v-card flat>
                                            <v-card-text class="pa-0">
                                                <v-container class="pa-0">
                                                    <v-row>
                                                        <v-col cols="12" sm="6" md="6" v-for="s in schema">
                                                            <v-text-field v-if="s.type === 'text'" :label="s.name"
                                                                          @change="inputChange(s.name, $event)"
                                                                          required></v-text-field>
                                                            <v-autocomplete :items="s.items" :label="s.name"
                                                                            @change="inputChange(s.name, $event)"
                                                                            :multiple="s.multiple"
                                                                            v-if="s.type === 'select'"></v-autocomplete>
                                                        </v-col>
                                                    </v-row>
                                                </v-container>
                                                <small>*indicates required field</small>
                                            </v-card-text>
                                        </v-card>
                                    </v-col>
                                </v-layout>
                            </v-container>
                            <v-layout row>
                                <v-col cols="2">
                                    <v-btn color="primary" block :loading="generating" text @click="submit">Generate
                                    </v-btn>
                                </v-col>
                            </v-layout>
                        </v-form>
                    </v-col>
                    <v-col cols="12" md="6" class="pt-12">
                        <v-alert border="top" color="red lighten-2" dark>
                            {{errorMsg}}
                        </v-alert>
                        <v-card class="mx-auto mt-12" v-for="c in code">
                            <v-card-text>
                                <p>Execution Result</p>
                                <div class="text--primary font-weight-bold code">{{c.content}}</div>
                            </v-card-text>
                            <v-card-actions>
                                <v-btn text color="deep-purple accent-4" disabled>BETA</v-btn>
                            </v-card-actions>
                        </v-card>
                    </v-col>
                </v-layout>
            </v-container>
        </v-main>
    </v-app>
</div>

<script src="https://cdn.jsdelivr.net/npm/vue@2.x/dist/vue.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.js"></script>
<script>

    new Vue({
        el: '#app',
        vuetify: new Vuetify(),
        methods: {

            inputChange(key, value) {
                this.data[key] = value
                // console.log(key, value)
                console.log(this.data)
            },

            async submit() {
                this.loading = true
                try {
                    let {data} = await axios.post(`/api/forms`, this.data, {params: {action: this.action}})
                    this.code = data
                } catch (e) {
                    this.errorMsg = "API called failed"
                    console.log(e)
                }
                this.loading = false
            },

            async loadForm() {
                this.loading = true
                try {
                    let {data} = await axios.get('/api/forms', {params: {action: this.action}})
                    this.schema = data
                } catch (e) {
                    this.errorMsg = "API called failed"
                    console.log(e)
                }
                this.loading = false
            }
        },

        data: {
            data: {},
            action: "",
            schema: [],
            errorMsg: '',
            loading: false,
            generating: false,
            tokenMsg: '',
            code: []
        }
    })
</script>
</body>
</html>
